<meta http-equiv="content-type" content="text/html; charset=UTF8">
<script type="text/javascript" src="coffeequate.js"></script>
<!-- <script type="text/javascript" src="extensions/M.Interval.js"></script> -->
<script>

/*
equation =  CQ("a * b = 12");
*/

var input = getQueryVariable("input");

var variables = [];
var aVar = "a";
variables[aVar] = 5;

var regex2match;

function parseInput(input){

	//TODO: convert input correct format

	var parsed = false;
	//1: Look for any variable initializations
		//check if the input starts with a string such as "a=3".
			if(/^[a-zA-Z]=/.test(input)){
				var variable = {};

				//if so then create a string that stores that character. e.g. 'a'
					//TODO: check if that variable already exists.
				variable["name"] = /^[a-zA-Z]/.exec(input)[0];

				//and determine and store the value of that variables
				var index = 2; //would be location of where the value after the equals sign starts.

				variable["value"] = input.substring(2);
				
				variables.push(variable);

				parsed = true;
			}
	//2: If the input is an expression, evaluate it (if its variables have stored values)
	if (!parsed){

		//the input is an expression if the input does not contain an equals sign
		if (/^[^=]+$/g.test(input)){
			console.log('the input does not contain an equals sign');

			//1. Create a list of all the variables found in the input expression
			var inputString = input;
			var variablesFoundInExpression = [];

			while (inputString.length > 0 ){
				match = /([a-zA-Z]+(?: [a-zA-Z]+)*)/g.exec(inputString);
				console.log("There was a variable %s found in the expression at index position %d", match[0], match.index);

				variablesFoundInExpression.push(match[0]);
				inputString = inputString.substring(match.index + 1);

			};

			//2. Determine which variables have values (e.g. they are currently present in the variables array).

			variablesWithValues = [];

			for (var i = 0; i < variables.length; i++){
				for (vf in variablesFoundInExpression){
					console.log("the variable in the expression is %s, and the variable in the array is %s with the value %d", vf, variables[i]['name'], parseInt(variables[i]['value']));
					if (vf == variables[0]["name"]){
						console.log(" %s, a variable in this expression was found to already have the value %d", variables[0]['name'], variables[0]['value']);
						variablesWithValues.push(variables[0]);
					}
				}
			}

			//3. Simplify the expression substituting in values for each of the variables that do have values.

				//3a. If there are any variables iwth values that could be substituted in, substitute them in
				if (variablesWithValues.length > 0){
					
				}



			
			//console.log(characters);
		}
		else console.log('the input contains an equals sign');

	}

	//3: If the input is an equation, and there is only one unknown variable, solve for that unknown variable.


}


/*
var SIdocument = function(){

}

SIdocument.prototype.workspaces = [];
*/

function getQueryVariable(variable)
{ 
  var query = window.location.search.substring(1); 
  var vars = query.split("&"); 
  for (var i=0;i<vars.length;i++)
  { 
    var pair = vars[i].split("="); 
    if (pair[0] == variable)
    { 
      return pair[1]; 
    } 
  }
  return -1; //not found 
}




</script>